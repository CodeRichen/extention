### 檔案名稱: background.js
-------------------------------------------------
chrome.action.onClicked.addListener((tab) => {
  chrome.scripting.executeScript({
    target: { tabId: tab.id },
    files: ['content.js']
  });
});

chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
  if (changeInfo.status === 'complete') {
    chrome.scripting.executeScript({
      target: { tabId: tabId },
      files: ['content.js']
    });
  }
});

### 檔案名稱: content.js
-------------------------------------------------
const style = document.createElement('style'); 
document.head.appendChild(style);

// 定義默認設置
const defaultSettings = {
  fontFamily: '微軟正黑體',
  enableBackground: true,
  backgroundScope: 'gpt',
  imageFolder: 'miku',
  selectionColor: 'purple'
};
const imageCounts = {
  miku: 15,
  pho: 10,
  beauty: 3700
};

// 用於儲存一致的背景圖片編號
let consistentImageNumber = null;

// 設置樣式
function setCustomStyles(settings) {
  const isGPTPage = window.location.hostname.includes('gpt') || window.location.hostname.includes('openai');
  const isGrokPage = window.location.hostname.includes('grok');
  const applyToAll = settings.backgroundScope === 'all';
  let cssRules = '';

  // 如果關閉背景與所有樣式，自動還原為預設字體與樣式
if (!settings.enableBackground) {
  style.textContent = `
    /* 還原背景 */
    body {
      background: none !important;
    }

    /* 還原字體 */
    * {
      font-family: default,-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Liberation Sans", Arial, sans-serif !important;
    }

    /* 移除你注入的選取樣式，不要強制背景色 */
    ::selection,
    ::-moz-selection {
      background-color: initial !important;
    }
  `;
  return;
}


  // ----------- 以下是開啟背景時的處理 --------------

// 套用文字顏色（如果開啟了）
if (settings.enableFontColor) {
  cssRules += `
    * {
      color: ${settings.fontColor} !important;
    }
  `;
}

  // 字體設置（除非是 default）
  if (settings.fontFamily && settings.fontFamily !== 'default') {
    cssRules += `
      * {
        font-family: '${settings.fontFamily}', sans-serif !important;
      }
    `;
  }

  // 選取文字樣式
  cssRules += `
    ::selection {
      background-color: ${settings.selectionColor || defaultSettings.selectionColor} !important;
    }
    ::-moz-selection {
      background-color: ${settings.selectionColor || defaultSettings.selectionColor} !important;
    }
  `;

  // 背景圖片設置
  if (applyToAll || isGPTPage || isGrokPage) {
    const folder = settings.imageFolder || defaultSettings.imageFolder;
    const maxImages = imageCounts[folder];
    let randomImageNumber;

    if (applyToAll) {
      if (consistentImageNumber === null) {
        consistentImageNumber = folder === 'beauty' 
          ? Math.floor(Math.random() * maxImages) + 400 
          : Math.floor(Math.random() * maxImages) + 1;
      }
      randomImageNumber = consistentImageNumber;
    } else {
      randomImageNumber = folder === 'beauty' 
        ? Math.floor(Math.random() * maxImages) + 400 
        : Math.floor(Math.random() * maxImages) + 1;
    }

    const extension = folder === 'pho' ? 'png' : 'jpg';
    cssRules += `
      body {
        background-image: url('chrome-extension://${chrome.runtime.id}/${folder}/wallpaper_${randomImageNumber}.${extension}') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
      }
    `;
  }

  style.textContent = cssRules;
}

// 從儲存中獲取設置並應用
function loadAndApplyStyles() {
chrome.storage.sync.get([
  'fontFamily',
  'enableBackground',
  'backgroundScope',
  'imageFolder',
  'selectionColor',
  'enableFontColor',
  'fontColor'
], (result) => {
  const settings = {
    fontFamily: result.fontFamily || defaultSettings.fontFamily,
    enableBackground: result.enableBackground !== undefined ? result.enableBackground : defaultSettings.enableBackground,
    backgroundScope: result.backgroundScope || defaultSettings.backgroundScope,
    imageFolder: result.imageFolder || defaultSettings.imageFolder,
    selectionColor: result.selectionColor || defaultSettings.selectionColor,
    enableFontColor: result.enableFontColor || false,
    fontColor: result.fontColor || '#ffffff'
  };
  setCustomStyles(settings);
});

}

// 初始載入樣式
loadAndApplyStyles();

// 監聽儲存變化
chrome.storage.onChanged.addListener((changes, namespace) => {
  if (changes.backgroundScope || changes.imageFolder) {
    consistentImageNumber = null; // 重置一致性編號
  }
  loadAndApplyStyles();
});

### 檔案名稱: popup.html
-------------------------------------------------
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自訂樣式調整</title>
    <style>
        body { width: 250px; padding: 10px; font-family: Arial, sans-serif; }
        label { font-size: 14px; display: block; margin: 5px 0; }
        span { margin-left: 5px; }
        button { margin: 5px 0; width: 100%; padding: 5px; cursor: pointer; }
        .option-group { margin: 10px 0; }
        select, input[type="color"] { width: 100%; padding: 5px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="option-group">
    <label>自訂文字顏色：</label>
    <select id="enableFontColor">
        <option value="off">關閉</option>
        <option value="on">開啟</option>
    </select>
    <input type="color" id="fontColorPicker" value="#ff0000" style="margin-top: 5px;">
</div>

    <div class="option-group">
        <label>選擇字體：</label>
        <select id="fontFamily">
            <option value="default">預設</option>
            <option value="851tegakizatsu">851tegakizatsu</option>
            <option value="Zen Maru Gothic">Zen Maru Gothic</option>
            <option value="WenQuanYi Bitmap Song 14px">WenQuanYi Bitmap Song 14px</option>
            <option value="清松手寫體3">清松手寫體3</option>
            <option value="'jf open 粉圓 2.1', sans-serif">jf open 粉圓 2.1</option>
        </select>
    </div>

    <div class="option-group">
        <label>啟用自訂樣式（含背景圖片）：</label>
        <select id="backgroundImage">
            <option value="none">關閉</option>
            <option value="on">開啟</option>
        </select>
    </div>

    <div class="option-group">
        <label>圖片資料夾：</label>
        <select id="imageFolder">
            <option value="miku">Miku</option>
            <option value="pho">Pho</option>
            <option value="beauty">Beauty</option>
        </select>
    </div>

    <div class="option-group">
        <label>背景作用範圍：</label>
        <select id="backgroundScope">
            <option value="gpt">僅 GPT/Grok 頁面</option>
            <option value="all">所有網頁</option>
        </select>
    </div>

    <div class="option-group">
        <label>選取文字背景顏色：</label>
        <input type="color" id="selectionColor" value="#800080"> <!-- 默認為紫色 -->
    </div>

    <button id="apply">套用</button>

    <script src="popup.js"></script>
</body>
</html>

### 檔案名稱: popup.js
-------------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
    const fontFamilySelect = document.getElementById('fontFamily');
    const backgroundImageSelect = document.getElementById('backgroundImage');
    const imageFolderSelect = document.getElementById('imageFolder');
    const backgroundScopeSelect = document.getElementById('backgroundScope');
    const selectionColorInput = document.getElementById('selectionColor');
    const applyButton = document.getElementById('apply');
    const enableFontColor = document.getElementById('enableFontColor').value === 'on';
    const fontColorPicker = document.getElementById('fontColorPicker');
    // 加載保存的設置
chrome.storage.sync.get([
    'fontFamily',
    'enableBackground',
    'imageFolder',
    'backgroundScope',
    'selectionColor',
    'enableFontColor',
    'fontColor'
], (result) => {
    fontFamilySelect.value = result.fontFamily || 'default';
    backgroundImageSelect.value = result.enableBackground ? 'on' : 'none';
    imageFolderSelect.value = result.imageFolder || 'miku';
    backgroundScopeSelect.value = result.backgroundScope || 'gpt';
    selectionColorInput.value = result.selectionColor || '#800080';

    document.getElementById('enableFontColor').value = result.enableFontColor ? 'on' : 'off';
    fontColorPicker.style.display = result.enableFontColor ? 'block' : 'none';
    fontColorPicker.value = result.fontColor || '#ffffff';
});


    // 套用設定
    applyButton.addEventListener('click', () => {
        const fontFamily = fontFamilySelect.value;
        const enableBackground = backgroundImageSelect.value === 'on';
        const imageFolder = imageFolderSelect.value;
        const backgroundScope = backgroundScopeSelect.value;
        const selectionColor = selectionColorInput.value;
        const enableFontColor = document.getElementById('enableFontColor').value === 'on';
        const fontColor = fontColorPicker.value;
        chrome.storage.sync.set({
            fontFamily: fontFamily,
            enableBackground: enableBackground,
            imageFolder: imageFolder,
            backgroundScope: backgroundScope,
            selectionColor: selectionColor,
            enableFontColor: enableFontColor,
            fontColor: fontColor
        }, () => {
            console.log('設置已保存');
        });
    });
});



### 資料夾結構 ###
[資料夾] 
  ├── 1.jpg
  ├── background.js
  ├── content.js
  ├── icon.png
  ├── manifest.json
  ├── output.txt
  ├── popup.html
  ├── popup.js
[資料夾] miku
  ├── downloaded_wallhaven_images.txt
  ├── wallpaper_1.jpg
  ├── wallpaper_10.jpg
  ├── wallpaper_11.jpg
  ├── wallpaper_12.jpg
  ├── wallpaper_13.jpg
  ├── wallpaper_14.jpg
  ├── wallpaper_15.jpg
  ├── wallpaper_2.jpg
  ├── wallpaper_3.jpg
  ├── wallpaper_4.jpg
  ├── wallpaper_5.jpg
  ├── wallpaper_6.jpg
  ├── wallpaper_7.jpg
  ├── wallpaper_8.jpg
  ├── wallpaper_9.jpg
[資料夾] pho
  ├── downloaded_pixabay_images.txt
  ├── wallpaper_1.png
  ├── wallpaper_10.png
  ├── wallpaper_2.png
  ├── wallpaper_3.png
  ├── wallpaper_4.png
  ├── wallpaper_5.png
  ├── wallpaper_6.png
  ├── wallpaper_7.png
  ├── wallpaper_8.png
  ├── wallpaper_9.png
加入功能:更改Google上面分頁和書籤那邊的背景圖片